"use strict";function init(){var t=new ymaps.Map("map",{center:[55.7536,37.621218],zoom:9,controls:["smallMapDefaultSet"]},{searchControlProvider:"yandex#search"}),o=new ymaps.Clusterer({clusterIcons:[{href:"img/ui-icon/pin-cluster.svg",size:[54,61],offset:[-27,-30]}],clusterNumbers:[10]}),s=$(".popup-map");s.switchPopup({btnClass:"js-tgl-popup-map",duration:"300",overflow:!1}),t.panes.get("ground").getElement().style.filter="grayscale(100%) invert(5%)";function i(e){var n=ymaps.geoQuery({type:"FeatureCollection",features:e.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:""!==(t=e).coords?[+(o=t.coords).split(",")[0],+o.split(",")[1]]:[0,0]},properties:{name:t.nameCompany,info:{phone:t.phone,address:t.addr,email:t.email,site:t.site}},options:{id:t.id,iconLayout:"default#image",iconImageHref:"img/ui-icon/pin.svg",iconImageSize:[54,61],iconImageOffset:[-27,-30]}};var t,o})});var a=null;n.addEvents("click",function(e){var t,o=e.get("target").properties._data,i=e.get("target").options._options.id;!function(e){$(".js-popup-name").text(e.name);var t=e.info,o=1;Object.keys(t).forEach(function(e){$(".js-list-popup").find(".map-list__item:nth-child("+o+") p").text(t[e]),o++})}(o),s.hasClass("display")||s.switchPopup("open"),t=i,a&&n._objects[a].options.set({iconLayout:"default#image",iconImageHref:"img/ui-icon/pin.svg",iconImageSize:[54,61],iconImageOffset:[-27,-30]}),Object.keys(n._objects).forEach(function(e){n._objects[e].options._options.id===t&&(a=e,n._objects[e].options.set({iconLayout:"default#image",iconImageHref:"img/ui-icon/pin-active.svg",iconImageSize:[54,61],iconImageOffset:[-27,-30]}))})}),o.add(n._objects),t.geoObjects.add(o)}$.ajax({url:"test.php",dataType:"json",success:function(e){i(e.data)},error:function(){console.log("ошибка сервера")}})}ymaps.ready(init);